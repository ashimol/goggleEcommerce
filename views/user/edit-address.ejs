<!DOCTYPE html>
<html lang="zxx">

<head>
	<title>Goggles Ecommerce Category Bootstrap responsive Web Template | Home :: w3layouts</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">
	<meta name="keywords" content="Goggles a Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template, 
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design" />
	<script>
		addEventListener("load", function () {
			setTimeout(hideURLbar, 0);
		}, false);

		function hideURLbar() {
			window.scrollTo(0, 1);
		}
	</script>
	<link href="/css/bootstrap.css" rel='stylesheet' type='text/css' />
	<link href="/css/login_overlay.css" rel='stylesheet' type='text/css' />
	<link href="/css/style6.css" rel='stylesheet' type='text/css' />
	<link rel="stylesheet" href="/css/shop.css" type="text/css" />
	<link rel="stylesheet" href="/css/owl.carousel.css" type="text/css" media="all">
	<link rel="stylesheet" href="/css/owl.theme.css" type="text/css" media="all">
	<link href="/css/style.css" rel='stylesheet' type='text/css' />
	<link href="/css/fontawesome-all.css" rel="stylesheet">
	<link href="//fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet">
	<link href="//fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800"
	    rel="stylesheet">
		<style>
			.dropdown{
				position: relative;
				display: inline-block;
			}
			.dropdown-content{
				display: none;
				position: absolute;
				background-color: aqua;
				min-width: 160px;
				box-shadow: 0px 8px 16px 6px rgba(0, 0, 0,2);
				z-index: 1000;
				right: 0;

			}
			.dropdown-content a {
				color: black;
				padding: 12px 16px;
				text-decoration: none;
				display: block;
				width: 100%;
			}
			.dropdown-content a:hover{
				background-color:whitesmoke;
			}
			.dropdown:hover .dropdown-content{
				display: block;
			}
			.header{
				position: relative;
				z-index: 500;
			}
		</style>
</head>
<body>


<style>
    /* Style for the form container */
    .form-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Style for form labels and inputs */
    label {
        display: block;
        font-size: 18px;
        margin-bottom: 5px;
        font-weight: 600;
    }

    input[type="text"] {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-bottom: 15px;
    }

    /* Style for the form's error messages */
    .error {
        color: red;
        font-size: 14px;
        margin-bottom: 10px;
    }

    /* Style for the buttons */
    .buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
    }

    .buttons button {
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        background-color: #28a745;
        color: white;
    }

    .buttons a button {
        background-color: #dc3545;
    }

    h2 {
        text-align: center;
        font-size: 24px;
        margin-bottom: 20px;
    }
</style>

<div class="container-fluid">
    <%- include("../../views/partials/user/header") %>
    
    <div class="dashboard-container">
     

      <div class="dashboard-content" id="dashboardContent">
        <div class="form-container">
            <h2>Edit Address</h2>
        
            <form id="addressForm" method="post" action="/user/edit-address/<%= address._id %>">
                <input type="hidden" id="addressId" name="addressId" value="<%= address._id %>">

                <label for="house">House:</label>
                <input type="text" id="house" name="house" value="<%= address.house %>">
                <div id="houseError" class="error"></div>

                <label for="city">City:</label>
                <input type="text" id="city" name="city" value="<%= address.city %>">
                <div id="cityError" class="error"></div>

                <label for="state">State:</label>
                <input type="text" id="state" name="state" value="<%= address.state %>">
                <div id="stateError" class="error"></div>

                <label for="pin">Pin:</label>
                <input type="text" id="pin" name="pin" value="<%= address.pin %>">
                <div id="pinError" class="error"></div>

                <label for="landMark">Landmark:</label>
                <input type="text" id="landMark" name="landMark" value="<%= address.landMark %>">
                <div id="landmarkError" class="error"></div>

                <label for="contactNo">Contact No:</label>
                <input type="text" id="contactNo" name="contactNo" value="<%= address.contactNo %>"disabled>
                <div id="contactError" class="error"></div>

                <div class="buttons">
                    <a href="/user/address"><button type="button">Cancel</button></a>
                    <button type="submit">Update</button>
                </div>
            </form>
        </div>
      </div>
    </div>
    
    <%- include("../../views/partials/user/footer") %>
</div>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.getElementById('addressForm').addEventListener('submit', function(event) {
        event.preventDefault(); 
        
       
        const originalValues = {
            house: "<%= address.house %>",
            city: "<%= address.city %>",
            state: "<%= address.state %>",
            pin: "<%= address.pin %>",
            landMark: "<%= address.landMark %>",
            contactNo: "<%= address.contactNo %>"
        };
    
        
        const house = document.getElementById('house').value.trim();
        const city = document.getElementById('city').value.trim();
        const state = document.getElementById('state').value.trim();
        const pin = document.getElementById('pin').value.trim();
        const landMark = document.getElementById('landMark').value.trim();
        const contactNo = document.getElementById('contactNo').value.trim();
    
        let isValid = true;
        let isChanged = false;
    
       
        const alphabetRegex = /^[A-Za-z\s]+$/;
        const pinRegex = /^[0-9]{6}$/;
        const contactRegex = /^[0-9]{10}$/;
    
       
        if (house === '') {
            document.getElementById('houseError').style.display = 'block';
            document.getElementById('houseError').innerText = 'House cannot be empty';
            isValid = false;
        } else {
            document.getElementById('houseError').style.display = 'none';
            if (house !== originalValues.house) isChanged = true;
        }
    
            
        if (!alphabetRegex.test(city) || city === '') {
            document.getElementById('cityError').style.display = 'block';
            document.getElementById('cityError').innerText = 'City must be alphabetic and not empty';
            isValid = false;
        } else {
            document.getElementById('cityError').style.display = 'none';
            if (city !== originalValues.city) isChanged = true;
        }
    
        if (!alphabetRegex.test(state) || state === '') {
            document.getElementById('stateError').style.display = 'block';
            document.getElementById('stateError').innerText = 'State must be alphabetic and not empty';
            isValid = false;
        } else {
            document.getElementById('stateError').style.display = 'none';
            if (state !== originalValues.state) isChanged = true;
        }
    
        if (!pinRegex.test(pin) || pin === '') {
            document.getElementById('pinError').style.display = 'block';
            document.getElementById('pinError').innerText = 'Pin must be 6 digits and not empty';
            isValid = false;
        } else {
            document.getElementById('pinError').style.display = 'none';
            if (pin !== originalValues.pin) isChanged = true;
        }
    
        if (!alphabetRegex.test(landMark) || landMark === '') {
            document.getElementById('landmarkError').style.display = 'block';
            document.getElementById('landmarkError').innerText = 'Landmark must be alphabetic and not empty';
            isValid = false;
        } else {
            document.getElementById('landmarkError').style.display = 'none';
            if (landMark !== originalValues.landMark) isChanged = true;
        }
    
        if (!contactRegex.test(contactNo) || contactNo === '') {
            document.getElementById('contactError').style.display = 'block';
            document.getElementById('contactError').innerText = 'Contact No must be 10 digits and not empty';
            isValid = false;
        } else {
            document.getElementById('contactError').style.display = 'none';
            if (contactNo !== originalValues.contactNo) isChanged = true;
        }
    
       
        if (!isChanged) {
            Swal.fire({
                icon: 'info',
                title: 'No changes made',
                text: 'You have not made any changes to the address.'
            });
            return;
        }
    
        if (isValid) {
            const formData = {
                house,
                city,
                state,
                pin,
                landMark,
                contactNo
            };
    
            fetch(`/user/edit-address/${document.getElementById('addressId').value}`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                Swal.fire({
                    icon: 'success',
                    title: 'Success',
                    text: 'Address updated successfully'
                });
            })
            .catch(error => {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops',
                    text: 'An error occurred while updating the address.'
                });
            });
        }
    });
    </script>
    